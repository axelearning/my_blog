I"zL<p>Today we will speak about one of my favorite hobbies: <strong>Football.</strong> The purpose of this project is to level up my skills in different fields while I am working on a subject I love. We will start from scratch by collecting our own data and end up by designing a <strong>dashboard</strong>. The goal is to find the most prolific soccer players on the season 2019-2020. Just bellow, you can find the final result. Underneath the dashboard, We will roll back the process together and discover how we can create this neat interactive visualization.</p>

<div class="tableauPlaceholder" id="viz1585028433847" style="position: relative">
	<noscript>
		<a href="#">
			<img alt=" " src="https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;So&#47;SoccerprojectV2&#47;Dashboard&#47;1_rss.png" style="border: none" />
		</a>
	</noscript>
	<object class="tableauViz" style="display:none;">
		<param name="host_url" value="https%3A%2F%2Fpublic.tableau.com%2F" /> 
		<param name="embed_code_version" value="3" /> 
		<param name="site_root" value="" />\
		<param name="name" value="SoccerprojectV2&#47;Dashboard" />
		<param name="tabs" value="no" />
		<param name="toolbar" value="no" />
		<param name="static_image" value="https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;So&#47;SoccerprojectV2&#47;Dashboard&#47;1.png" /> 
		<param name="animate_transition" value="yes" />
		<param name="display_static_image" value="yes" />
		<param name="display_spinner" value="yes" />
		<param name="display_overlay" value="yes" />
		<param name="display_count" value="yes" />
	</object>
</div>

<script type="text/javascript">                    
	var divElement = document.getElementById('viz1585028433847');
	var vizElement = divElement.getElementsByTagName('object')[0];                    
	vizElement.style.width='100%';
	vizElement.style.height=(divElement.offsetWidth*1.05)+'px';                    
	var scriptElement = document.createElement('script');                    
	scriptElement.src = 'https://public.tableau.com/javascripts/api/viz_v1.js';                    
	vizElement.parentNode.insertBefore(scriptElement, vizElement);                
</script>

<h2 id="what-i-have-learned"><code class="highlighter-rouge">What I have learned?</code></h2>
<ul>
  <li><strong>Web Scrapping:</strong> After playing around with <em>Beautifull Soup</em> and Se<em>lenium</em>, I now have in my toolkits the basic skill of dynamic scrapping</li>
  <li><strong>Data Analysis:</strong> I have increased my skills in processing messy data into a structured and clean form.  I also gain insight and create new interesting features to improve the visualization</li>
  <li><strong>Data Visualisation:</strong> I discover Tableau public and all the cool features of this software.</li>
  <li><strong>UNIX command:</strong> I expanded my skill in the shell while I was creating the automation of the program</li>
</ul>

<hr />
<p>In this article, I will share with you my experience on this first project. Nevertheless, we will not go too much in code detailed so if you are interested and want to go deeper, you can find all the files of this project on my GitHub page, just right here.</p>

<ol>
  <li><strong>Get the data</strong></li>
  <li><strong>Clean and prepared the database</strong></li>
  <li><strong>Design the visualisation</strong></li>
  <li><strong>Leave the loop</strong></li>
</ol>

<hr />
<h1 id="1-get-the-data">1. Get the data</h1>
<hr />
<p>Welcome guys in the most important part of the project: collecting the data. We need to be careful regarding the source of our data. We can create the most insightful visualization but if we are using crapy data we can not output a valuable product. Data are the fuel of our car, without it, we can‚Äôt go anywhere! Even if we have the last Lamborghini, or if we are Lewis Hamilton‚Äôs brother.</p>

<p><strong>How to collect data?</strong><br /> 
We have multiple choices! First of all, we can <strong>find an existing database.</strong> It is the easiest way, all the work is done for us. We just need to download the files! However they are sometime hard to find or we often need to pay for it.  If we can‚Äôt find any suitable database, or if we are broke, we need to create one by ourselves. That means, we have to gather the data from the web by an <strong><a href="https://en.wikipedia.org/wiki/Application_programming_interface">API</a></strong>, or by <strong><a href="https://en.wikipedia.org/wiki/Web_scraping">Web Scraping</a>.</strong> API is often easier to use but not all the web site have one. In my case, I decided to collect the data by Web Scraping. I think it is a good starting point to understand web pages syntaxes when you are a beginner.</p>

<p><strong>What I have done?</strong><br /> 
I start my project by gathering the 250 players with the best total of goals and assists on the season 2019-2020. I decided to choose the website <a href="https://www.transfermarkt.com/meisteeinsaetze/topscorer/statistik/2019/art//saison_id/2019/altersklasse//ausrichtung//spielerposition_id/0/land_id/0">Transfermarkt</a>. It is one of the largest and reliable sports websites.  In figure 1, we can see the first website page, 25 players with the best totals.  After a while, I find out how to handle dynamic Web Scraping by creating a bot who automatically browses and scrape data through the 10 pages of the website. I finally get the table which stores the 250 players with the best total, see figure 2.</p>

<hr />
<p><img src="/my_blog/assets/soccer_project/fig1.png" alt="figure 1" />
<em><center>figure 1: the bottom of the 1/10 page for the top scorrer</center></em></p>

<hr />
<p><img src="/my_blog/assets/soccer_project/fig2.png" alt="figure 2" />
<em><center>figure 2: Output after fetching the data with the first bot, open on Jupyter notebook</center></em></p>

<hr />

<p>However, the data I have collected so far are global information for each player. In this second part, we will see how we have collected, detailed results on player. For that, we scrape towards the site <a href="https://fbref.com/en/">Fbref</a>, which contains more detailed data. On this website, we can find as expected goals, minutes played, penalties attempts and so on for each game during the season. For instance, in figure 3, we can see the detailed data of Ciro Immobile during the season 2019-2020.  In this case, the scrapping process is more complicated than the first one. To understand why let‚Äôs quickly compare the two bots. The first one just needs to browse through the 10 pages of the site to collect the 250 best players‚Äô info while the second has to search each player personal page, find into it the table with the detailed result on the actual season and collect the data. That process needs to be done for the 250 players, the main problem is that the player‚Äôs page is not similar.  To be honest, That was the trickiest part and I was close to bang my head into a wall. However, after a while, I finally found out how to handle the scraping process for each player. We can see the result in figure 4.</p>

<hr />
<p><img src="/my_blog/assets/soccer_project/fig3.png" alt="figure 3" />
<em><center>figure 3: screenshot of the detailed data in the website Fbref</center></em></p>

<hr />

<p><img src="/my_blog/assets/soccer_project/fig4.png" alt="figure 4" />
<em><center>figure 4: Final database output after scraping the web with our two bots</center></em></p>

<hr />

<p>To sum up, we create our own database with python web scraping libraries to have access to detailed results on the 250 most prolific players of the world. Now, we need to clean and prepared data before visualization - part 2. Then we will explore different visualization on Tableau - part 3. And finally, we need to leave the loop by automating the update of the database  - part 4.  Bellow, I share with you some interesting resource on Web Scrapping:</p>

<ul>
  <li><strong><a href="https://towardsdatascience.com/controlling-the-web-with-python-6fceb22c5f08#0da5">An adventure in simple web automation</a>,</strong> a good first lecture to understand how web automation works on python</li>
  <li><strong><a href="https://www.youtube.com/watch?v=lvFAuUcowT4&amp;t=109s">Automate TINDER with Python tutorial</a>,</strong> a tutorial  video which go through all the process to create a bot</li>
  <li><strong><a href="https://medium.com/ymedialabs-innovation/web-scraping-using-beautiful-soup-and-selenium-for-dynamic-page-2f8ad15efe25#5dd0">An introduction to dynamique Web Scrapping</a></strong> with Selenium and Beautiful Soup</li>
</ul>

<h1 id="2-clean-and-prepared-the-database">2. Clean and prepared the database</h1>
<hr />
<p>The goal of this part is to clean and prepare the data before visualization. Here we will use python data analysis library, called <a href="https://en.wikipedia.org/wiki/Pandas_(software)">pandas</a>, which provides an effective solution to perform data preparation. I mean loading, cleaning, transforming, and rearranging the data. Data preparation might be an annoying task and it is often time-consuming. Therefore, the active and wide community in stack overflow of pandas is a must-have when you begin in data science and you get often stuck. In our case, we proceed with basic tasks such as handling missing data or converting data type. For more detailed take a look at the Jupyter notebook on the GitHub page, detailed_stats/analysis.ipynb, I tried to write annotations during the process.</p>

<hr />
<p><img src="/my_blog/assets/soccer_project/fig5.png" alt="figure 5" />
<em><center>figure 5: Example of data analysis with pandas on Jupyter Notebook</center></em></p>

<hr />

<p>By now we have a clean and basic data frame and we can start exploring the data. I enjoy this part, we start understanding what happened and I feel like Sherlock Holmes.  This part is often called data exploration, we will create visualization for the purpose to gain insights that will sharpen our expectations on our final product. Then when we have a more precise idea of what we want, we can go back to our analysis on python and complete it with new features and so on until we are satisfied with our result.</p>

<p><strong>What I have done?</strong> <br /> 
In my case, I make the choice to group the game during the season in four buckets: domestic league, Champion league, Europa League and Cup. Thus, it is possible to filter the players by game categories. I also create two new features that describe how a player is effective. These attributes describe the average time in minutes for a player to score and to give an assist.</p>

<p>For example, in his domestic league, Erling Haaland scored 25 times but he scored on average every 60 minutes. On the other hand, Ciro Immobile scored 27 goals in his domestic league but he had an average time per goal higher of 79 minutes. That means Haaland is a more effective player even if he scored less.</p>

<p>Finally, we have a decent input for our final visualization! Do not forget this is an iterative process between preparation and visualization. I do not create this analysis in one shot, I create a basic simple analysis. Then, I was growing insight into Tableau by exploring the data. Thus, I was able to have a clear idea of what I want for my Dashboard. I transform that idea into new features by going back on my Jupyter Notebook and so on until I was satisfied with my Dashboard. In the next part, we will see why we bother to handle the visualization part on Tableau instead of simply using python visualization libraries. To go deeper into analysis with python, I recommend the <a href="https://wesmckinney.com/pages/book.html">book</a> of Wes McKinney, a superb resource to get started with pandas and the other data science libraries!</p>

<h1 id="3-design-the-visualisation">3. Design the visualisation</h1>
<hr />
<p><strong>How to chose between Tableau or Python visualisation ?</strong><br /> 
Python libraries as matplotlib, seaborn, plotly, and others are very functional and capable of almost any visualization. On the other hand, Tableau is quite easy to use, with a large panel of tools, and gives us wonderful visualization. Moreover, Tableau‚Äôs built-in instruments speed the process of complex visualization. For instance, it is effortless to create a map plot or use interactive filters. Tableau is a strong tool when we want to present our results to a client or when the visualization is really important. However, it could be annoying to juggling between Tableau for data visualization and Python. Therefore, if we just create basic visualization for gaining insight from the data we are good with Python.  In some cases, when we need extra customization, we can also hit the limit of Tableau in this case we have to use Python as well.</p>

<p><strong>What I have done?</strong> <br /> 
In my case, I keep the dashboard simple, with two plots. The one on the top relates the number of goals and assists of the ten best players. The bottom one, ‚ÄúAverage time per Goals‚Äù, display the ten most effective scorer, I mean players with the best ratio of goals by minutes played. The Dashboard are interactive with two filters.  The first one, give the possibility to play on a range of date and the other to pick the competition type - domestic league, cup, and  European cup. I add some additional information in the tooltip of each plot as well.</p>

<p>To conclude this part, our beautiful visualization can already be used. However, in some cases such as mine, we will often need to refresh the data. In the next part, we will see how to automate this process and get out of the loop. Bellow some good resource I found regarding Tableau:</p>

<ul>
  <li><strong><a href="https://public.tableau.com/en-us/s/resources">Tutorial from Tableau public</a>,</strong> learn the basics with Tableau itself</li>
  <li><strong><a href="https://www.youtube.com/watch?v=Lu0jrymqOGM&amp;t=734s">10 Tableau Dashboard Design Tips</a>,</strong> a youtube video to create a clean Dashboard</li>
  <li><strong><a href="https://www.youtube.com/watch?v=CAZ3IAJEuCI&amp;t=1505s">Tips and Tricks from a Tableau Jedi</a>,</strong> a youtube video with some useful tips</li>
</ul>

<h1 id="4-get-out-of-the-loop">4. Get out of the loop</h1>
<hr />
<p>By now, we scraped the web to create a detailed database of the most prolific players. Then we have cleaned and explored the data for the purpose to create a dashboard on Tableau. By now, we can share on our website our dashboard and start using it like a tool to compare the different players. Nevertheless, if the data are not updated every week dashboard will become useless and non-accurate. As each team plays on average one game per week, players statistics‚Äô will grow every week and the dashboard will be up to date. If we don‚Äôt need to update our data as often, we can manually update it. However, this boring task can be updated and we can make better use of our time!</p>

<p><strong>Automate the boring stuff</strong></p>

<p>As already discuss, our data need to be updated every week. To leave the loop, we will create <a href="https://en.wikipedia.org/wiki/Daemon_(computing)">a background process</a> which run every Monday at 12:30 PM our programs. <strong>I will explained how I handle it on my a MAC computer, it might be different on a different operating system</strong>.  To do it I used a tool call launchd, a tool for starting, stopping and managing scripts and processes. First  you need to defined the task to proceed in background  on a XML code. You will give a name to our job, specify the task you need to automate, and define a schedule. This XML code are stored as a <code class="highlighter-rouge">.plist</code> in <code class="highlighter-rouge">~/Library/LaunchdAgents</code>.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
    <span class="cp">&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;</span>
    <span class="nt">&lt;plist</span> <span class="na">version=</span><span class="s">"1.0"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;dict&gt;</span>
    		<span class="c">&lt;!--script name--&gt;</span>
        <span class="nt">&lt;key&gt;</span>Label<span class="nt">&lt;/key&gt;</span>
        <span class="nt">&lt;string&gt;</span>soccer.analysis<span class="nt">&lt;/string&gt;</span>
    
    		<span class="c">&lt;!--script job--&gt;</span> 
        <span class="nt">&lt;key&gt;</span>ProgramArguments<span class="nt">&lt;/key&gt;</span>
        <span class="nt">&lt;array&gt;</span>
            <span class="nt">&lt;string&gt;</span>/Users/axel/opt/anaconda3/bin/python<span class="nt">&lt;/string&gt;</span> <span class="c">&lt;!--python path--&gt;</span>
            <span class="nt">&lt;string&gt;</span>file/path<span class="nt">&lt;/string&gt;</span> <span class="c">&lt;!--python file path--&gt;</span>
        <span class="nt">&lt;/array&gt;</span>
    
       <span class="c">&lt;!--run every 3 hours--&gt;</span>
    	<span class="nt">&lt;key&gt;</span>StartCalendarInterval<span class="nt">&lt;/key&gt;</span>
    	<span class="nt">&lt;dict&gt;</span>
    		<span class="nt">&lt;key&gt;</span>Weekday<span class="nt">&lt;/key&gt;</span>
    		<span class="nt">&lt;integer&gt;</span>0<span class="nt">&lt;/integer&gt;</span>
    		<span class="nt">&lt;key&gt;</span>Hour<span class="nt">&lt;/key&gt;</span>
    		<span class="nt">&lt;integer&gt;</span>12<span class="nt">&lt;/integer&gt;</span>
    		<span class="nt">&lt;key&gt;</span>Minutes<span class="nt">&lt;/key&gt;</span>
    		<span class="nt">&lt;integer&gt;</span>30<span class="nt">&lt;/integer&gt;</span>		
    	<span class="nt">&lt;/dict&gt;</span>
    
        <span class="c">&lt;!--collect errors &amp; output--&gt;</span>
        <span class="nt">&lt;key&gt;</span>StandardOutPath<span class="nt">&lt;/key&gt;</span>
        <span class="nt">&lt;string&gt;</span>/tmp/collect.data.covid974.out<span class="nt">&lt;/string&gt;</span>
        <span class="nt">&lt;key&gt;</span>StandardErrorPath<span class="nt">&lt;/key&gt;</span>
        <span class="nt">&lt;string&gt;</span>/tmp/collect.data.covid974.err<span class="nt">&lt;/string&gt;</span>
    <span class="nt">&lt;/dict&gt;</span>
    <span class="nt">&lt;/plist&gt;</span>
</code></pre></div></div>

<p>Next from the shell we need to load our scripts.</p>
<pre><code class="language-zhs">    cd ~/Library/LaunchAgents
    launchdctl load soccer.analysis 
</code></pre>
<p>And that all our script will run our python in background every morning a 12:30 pm ü•≥</p>

<p>To have better explanation on this topic you might want take a look at this posts:</p>

<ul>
  <li>[<strong>Launchd documentation](https://www.launchd.info/),</strong> complete and well explain</li>
  <li>[<strong>How to Use launchd to Run Scripts on Schedule in macOS](https://www.maketecheasier.com/use-launchd-run-scripts-on-schedule-macos/),</strong> detailed explanation of the process</li>
</ul>

<h1 id="conclusion">Conclusion</h1>
<hr />
<p>I realised how is it important to work on personal project to level up and sharpen my skills. Moreover, as long as we clearly define what we want to do grammatical language programming are easy to find online - when the community is wide. That why from my perspective, the most important skills are for me computer thinking, and problems solving.</p>
:ET